{"changed":true,"filter":false,"title":"app.py","tooltip":"/app.py","value":"from flask import Flask, render_template, request, redirect, url_for, flash, get_flashed_messages, jsonify\nimport os\nimport pymongo\nfrom bson.objectid import ObjectId\nfrom bson.json_util import dumps\nimport time\n\nfrom flask_uploads import UploadSet, IMAGES, configure_uploads\n# from bson.json_util import dumpsb\n\n\n# Timestamp function\ndef timestamp():\n  now = int(round(time.time()*1000))\n  time_now = time.strftime('%Y-%m-%d %H:%M:%S', time.localtime(now/1000))\n  return time_now\n  \napp = Flask(__name__)\n# create app route and test it\nTOP_LEVEL_DIR = os.path.abspath(os.curdir) \nupload_dir = '/static/uploads/images/'\napp.config[\"UPLOADS_DEFAULT_DEST\"] = TOP_LEVEL_DIR + upload_dir\napp.config[\"UPLOADED_IMAGES_DEST\"] = TOP_LEVEL_DIR + upload_dir\napp.config[\"UPLOADED_IMAGES_URL\"] = upload_dir\n\n# create an upload set and name it as images\nimages_upload_set = UploadSet(\"images\", IMAGES) \nconfigure_uploads(app, images_upload_set)\n\n# Retrieve environment environment\nMONGO_URI = os.getenv('MONGO_URI')\n#MONGO_URI = os.environ['MONGOLAB_URI']\nDATABASE_NAME = 'project_photogallery'\nALBUMS = 'albums'\nPHOTOS = 'images'\n# Create connection\nconn = pymongo.MongoClient(MONGO_URI)\ndb = conn[DATABASE_NAME]\n\n# Function to display landing page (Working)\n@app.route('/')\ndef index():\n    messages = get_flashed_messages()\n    print(messages)\n    results = db[ALBUMS].find({})\n    # print(dumps(results))\n    return render_template(\"index.html\", data = results)\n\n# Function to display albums (Working)\n@app.route('/albums')\ndef display_albums():\n    albums = db[ALBUMS].find({})\n    return render_template('layout1.html',data = albums)\n\n# Route to show the page for uploading (Working)\n@app.route('/photos')\ndef photos():\n    results = db[PHOTOS].find({})\n    return render_template(\"photos.html\", data = results)    \n\n# Function to form to edit album (Working)\n@app.route('/albums/<albumid>/edit_album')\ndef edit_selected_album(albumid):\n    # album_name = request.form.get('album_name')\n    # album_description = request.form.get('album_description')\n    \n    selected_album = db[ALBUMS].find_one({\"_id\": ObjectId(albumid)})\n    \n    # db[ALBUMS].update(\n    #     {'_id':ObjectId(albumid)},\n    #     { '$set':\n    #         {\n    #             'album_name': album_name,\n    #             'album_description': album_description,\n    #             'edited_on': timestamp(),\n    #         }\n    #     })\n\n    # flash(\"Successfully edited.\")\n    return render_template(\"layout1edit.html\", data = selected_album)\n    \n    \n    \n# Function to show contents of selected album (Working)\n@app.route('/albums/<albumid>')\ndef display_selected_album(albumid):\n    selected_album = db[ALBUMS].find_one({\"_id\": ObjectId(albumid)})\n    results = db[PHOTOS].find({})\n    return render_template(\"layout1display.html\", data = selected_album, photos = results)    \n    \n\n# Function to show delete confirmation page (Working)\n@app.route('/albums/<albumid>/confirm_delete')\ndef display_delete_confirmation(albumid):\n    selected_album = db[ALBUMS].find_one({\"_id\": ObjectId(albumid)})\n    return render_template(\"layout1delete.html\", data = selected_album)\n    \n    \n# Route to process the soft delete (Working)\n@app.route('/albums/<albumid>/delete')\ndef process_delete_album(albumid):\n    selected_album = db[ALBUMS].find_one({\"_id\": ObjectId(albumid)})\n    db[ALBUMS].update(\n        {'_id':ObjectId(albumid)},\n        { '$set':\n            {\n                'deleted':'1',\n                'deleted_on': timestamp(),        \n            }\n        })\n    flash(\"Album: {} has been deleted\".format(selected_album['album_name']))\n    return redirect(url_for('display_albums'))\n    \n\n\n# Route to process the upload (Working)\n@app.route('/photos/upload', methods=['POST'])\ndef process_upload_photos():\n    # Extract fields from upload form\n    image = request.files.get('image')\n    filename = images_upload_set.save(image)\n    # Get file name and file extension\n    filename_raw, file_extension = os.path.splitext(TOP_LEVEL_DIR + upload_dir + filename)\n    filesize = os.path.getsize(TOP_LEVEL_DIR + upload_dir + filename)\n    caption = request.form.get('caption')\n    tags = request.form.get('tags')\n    # Validation check to see if any file has been uploaded before POSTing to database\n    if filename is not None:\n        db[PHOTOS].insert({\n            'image_url' : images_upload_set.url(filename),\n            'image_name' : filename, \n            'image_caption' : caption,\n            'image_tags' : tags,\n            'uploaded_on' : timestamp(),\n            'deleted': 0,\n            'deleted_on' : \"null\",\n            # Converts filesize to mb 3sf\n            'file_size' : round((filesize/1000000),3),\n            'file_type' : file_extension,\n            })\n        flash(\"Images have been uploaded successfully.\")    \n        return redirect(url_for('photos'))\n    else:\n        flash(\"Please upload a photo before submitting.\")\n        return redirect(url_for('photos'))\n\n    \n# \"magic code\" -- boilerplate\nif __name__ == '__main__':\n    app.secret_key = 'super secret key'\n    app.config['SESSION_TYPE'] = 'filesystem'\n    \n    app.run(host=os.environ.get('IP'),\n            port=int(os.environ.get('PORT')),\n            debug=True)\n\n\n\n","undoManager":{"mark":99,"position":100,"stack":[[{"start":{"row":63,"column":14},"end":{"row":64,"column":0},"action":"insert","lines":["",""],"id":1754},{"start":{"row":64,"column":0},"end":{"row":64,"column":4},"action":"insert","lines":["    "]},{"start":{"row":64,"column":4},"end":{"row":64,"column":5},"action":"insert","lines":["a"]},{"start":{"row":64,"column":5},"end":{"row":64,"column":6},"action":"insert","lines":["l"]},{"start":{"row":64,"column":6},"end":{"row":64,"column":7},"action":"insert","lines":["b"]},{"start":{"row":64,"column":7},"end":{"row":64,"column":8},"action":"insert","lines":["u"]},{"start":{"row":64,"column":8},"end":{"row":64,"column":9},"action":"insert","lines":["m"]},{"start":{"row":64,"column":9},"end":{"row":64,"column":10},"action":"insert","lines":["_"]}],[{"start":{"row":64,"column":10},"end":{"row":64,"column":11},"action":"insert","lines":["d"],"id":1755},{"start":{"row":64,"column":11},"end":{"row":64,"column":12},"action":"insert","lines":["e"]},{"start":{"row":64,"column":12},"end":{"row":64,"column":13},"action":"insert","lines":["s"]},{"start":{"row":64,"column":13},"end":{"row":64,"column":14},"action":"insert","lines":["c"]},{"start":{"row":64,"column":14},"end":{"row":64,"column":15},"action":"insert","lines":["i"]},{"start":{"row":64,"column":15},"end":{"row":64,"column":16},"action":"insert","lines":["r"]},{"start":{"row":64,"column":16},"end":{"row":64,"column":17},"action":"insert","lines":["p"]},{"start":{"row":64,"column":17},"end":{"row":64,"column":18},"action":"insert","lines":["t"]}],[{"start":{"row":64,"column":18},"end":{"row":64,"column":19},"action":"insert","lines":["i"],"id":1756},{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"insert","lines":["o"]},{"start":{"row":64,"column":20},"end":{"row":64,"column":21},"action":"insert","lines":["n"]}],[{"start":{"row":64,"column":14},"end":{"row":64,"column":15},"action":"remove","lines":["i"],"id":1757}],[{"start":{"row":64,"column":15},"end":{"row":64,"column":16},"action":"insert","lines":["i"],"id":1758}],[{"start":{"row":63,"column":14},"end":{"row":63,"column":15},"action":"insert","lines":[" "],"id":1759},{"start":{"row":63,"column":15},"end":{"row":63,"column":16},"action":"insert","lines":["="]}],[{"start":{"row":63,"column":16},"end":{"row":63,"column":17},"action":"insert","lines":[" "],"id":1760},{"start":{"row":63,"column":17},"end":{"row":63,"column":18},"action":"insert","lines":["r"]},{"start":{"row":63,"column":18},"end":{"row":63,"column":19},"action":"insert","lines":["e"]},{"start":{"row":63,"column":19},"end":{"row":63,"column":20},"action":"insert","lines":["q"]},{"start":{"row":63,"column":20},"end":{"row":63,"column":21},"action":"insert","lines":["u"]},{"start":{"row":63,"column":21},"end":{"row":63,"column":22},"action":"insert","lines":["e"]},{"start":{"row":63,"column":22},"end":{"row":63,"column":23},"action":"insert","lines":["s"]},{"start":{"row":63,"column":23},"end":{"row":63,"column":24},"action":"insert","lines":["t"]},{"start":{"row":63,"column":24},"end":{"row":63,"column":25},"action":"insert","lines":["."]},{"start":{"row":63,"column":25},"end":{"row":63,"column":26},"action":"insert","lines":["f"]},{"start":{"row":63,"column":26},"end":{"row":63,"column":27},"action":"insert","lines":["o"]},{"start":{"row":63,"column":27},"end":{"row":63,"column":28},"action":"insert","lines":["r"]},{"start":{"row":63,"column":28},"end":{"row":63,"column":29},"action":"insert","lines":["m"]}],[{"start":{"row":63,"column":29},"end":{"row":63,"column":30},"action":"insert","lines":["."],"id":1761},{"start":{"row":63,"column":30},"end":{"row":63,"column":31},"action":"insert","lines":["g"]},{"start":{"row":63,"column":31},"end":{"row":63,"column":32},"action":"insert","lines":["e"]},{"start":{"row":63,"column":32},"end":{"row":63,"column":33},"action":"insert","lines":["t"]}],[{"start":{"row":63,"column":33},"end":{"row":63,"column":35},"action":"insert","lines":["()"],"id":1762}],[{"start":{"row":63,"column":34},"end":{"row":63,"column":36},"action":"insert","lines":["''"],"id":1763}],[{"start":{"row":63,"column":35},"end":{"row":63,"column":36},"action":"insert","lines":["a"],"id":1764},{"start":{"row":63,"column":36},"end":{"row":63,"column":37},"action":"insert","lines":["l"]},{"start":{"row":63,"column":37},"end":{"row":63,"column":38},"action":"insert","lines":["b"]},{"start":{"row":63,"column":38},"end":{"row":63,"column":39},"action":"insert","lines":["u"]},{"start":{"row":63,"column":39},"end":{"row":63,"column":40},"action":"insert","lines":["m"]}],[{"start":{"row":63,"column":35},"end":{"row":63,"column":40},"action":"remove","lines":["album"],"id":1765},{"start":{"row":63,"column":35},"end":{"row":63,"column":45},"action":"insert","lines":["album_name"]}],[{"start":{"row":64,"column":21},"end":{"row":64,"column":22},"action":"insert","lines":[" "],"id":1766},{"start":{"row":64,"column":22},"end":{"row":64,"column":23},"action":"insert","lines":["="]}],[{"start":{"row":64,"column":23},"end":{"row":64,"column":24},"action":"insert","lines":[" "],"id":1767},{"start":{"row":64,"column":24},"end":{"row":64,"column":25},"action":"insert","lines":["r"]},{"start":{"row":64,"column":25},"end":{"row":64,"column":26},"action":"insert","lines":["e"]},{"start":{"row":64,"column":26},"end":{"row":64,"column":27},"action":"insert","lines":["q"]},{"start":{"row":64,"column":27},"end":{"row":64,"column":28},"action":"insert","lines":["u"]},{"start":{"row":64,"column":28},"end":{"row":64,"column":29},"action":"insert","lines":["e"]},{"start":{"row":64,"column":29},"end":{"row":64,"column":30},"action":"insert","lines":["s"]},{"start":{"row":64,"column":30},"end":{"row":64,"column":31},"action":"insert","lines":["t"]}],[{"start":{"row":64,"column":31},"end":{"row":64,"column":32},"action":"insert","lines":["."],"id":1768},{"start":{"row":64,"column":32},"end":{"row":64,"column":33},"action":"insert","lines":["f"]},{"start":{"row":64,"column":33},"end":{"row":64,"column":34},"action":"insert","lines":["o"]},{"start":{"row":64,"column":34},"end":{"row":64,"column":35},"action":"insert","lines":["r"]},{"start":{"row":64,"column":35},"end":{"row":64,"column":36},"action":"insert","lines":["m"]},{"start":{"row":64,"column":36},"end":{"row":64,"column":37},"action":"insert","lines":["."]},{"start":{"row":64,"column":37},"end":{"row":64,"column":38},"action":"insert","lines":["g"]},{"start":{"row":64,"column":38},"end":{"row":64,"column":39},"action":"insert","lines":["e"]},{"start":{"row":64,"column":39},"end":{"row":64,"column":40},"action":"insert","lines":["t"]}],[{"start":{"row":64,"column":40},"end":{"row":64,"column":42},"action":"insert","lines":["()"],"id":1769}],[{"start":{"row":64,"column":41},"end":{"row":64,"column":43},"action":"insert","lines":["''"],"id":1770}],[{"start":{"row":64,"column":42},"end":{"row":64,"column":43},"action":"insert","lines":["a"],"id":1771},{"start":{"row":64,"column":43},"end":{"row":64,"column":44},"action":"insert","lines":["l"]},{"start":{"row":64,"column":44},"end":{"row":64,"column":45},"action":"insert","lines":["b"]},{"start":{"row":64,"column":45},"end":{"row":64,"column":46},"action":"insert","lines":["u"]},{"start":{"row":64,"column":46},"end":{"row":64,"column":47},"action":"insert","lines":["m"]}],[{"start":{"row":64,"column":42},"end":{"row":64,"column":47},"action":"remove","lines":["album"],"id":1772},{"start":{"row":64,"column":42},"end":{"row":64,"column":59},"action":"insert","lines":["album_description"]}],[{"start":{"row":64,"column":61},"end":{"row":65,"column":0},"action":"insert","lines":["",""],"id":1773},{"start":{"row":65,"column":0},"end":{"row":65,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":78,"column":4},"end":{"row":81,"column":25},"action":"remove","lines":["if completed == 'true':","        completed = True","    else:","        completed = False"],"id":1774}],[{"start":{"row":76,"column":45},"end":{"row":78,"column":4},"action":"remove","lines":["","    # because what get through the form is a string","    "],"id":1775}],[{"start":{"row":67,"column":4},"end":{"row":68,"column":0},"action":"insert","lines":["",""],"id":1776},{"start":{"row":68,"column":0},"end":{"row":68,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":67,"column":4},"end":{"row":68,"column":0},"action":"insert","lines":["",""],"id":1778},{"start":{"row":68,"column":0},"end":{"row":68,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":68,"column":4},"end":{"row":76,"column":6},"action":"insert","lines":["conn[DATABASE_NAME][TASKS].update({","        '_id':ObjectId(taskid)","    }, {","        '$set': {","            'title' : title,","            'description': description,","            'completed': completed","        }","    })"],"id":1779}],[{"start":{"row":76,"column":6},"end":{"row":77,"column":0},"action":"insert","lines":["",""],"id":1780},{"start":{"row":77,"column":0},"end":{"row":77,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":68,"column":0},"end":{"row":76,"column":6},"action":"remove","lines":["    conn[DATABASE_NAME][TASKS].update({","        '_id':ObjectId(taskid)","    }, {","        '$set': {","            'title' : title,","            'description': description,","            'completed': completed","        }","    })"],"id":1782},{"start":{"row":68,"column":0},"end":{"row":75,"column":10},"action":"insert","lines":["db[ALBUMS].update(","        {'_id':ObjectId(albumid)},","        { '$set':","            {","                'deleted':'1',","                'deleted_on': timestamp(),        ","            }","        })"]}],[{"start":{"row":68,"column":0},"end":{"row":68,"column":4},"action":"insert","lines":["    "],"id":1783}],[{"start":{"row":72,"column":17},"end":{"row":72,"column":24},"action":"remove","lines":["deleted"],"id":1784},{"start":{"row":72,"column":17},"end":{"row":72,"column":18},"action":"insert","lines":["a"]},{"start":{"row":72,"column":18},"end":{"row":72,"column":19},"action":"insert","lines":["l"]},{"start":{"row":72,"column":19},"end":{"row":72,"column":20},"action":"insert","lines":["b"]},{"start":{"row":72,"column":20},"end":{"row":72,"column":21},"action":"insert","lines":["u"]},{"start":{"row":72,"column":21},"end":{"row":72,"column":22},"action":"insert","lines":["m"]}],[{"start":{"row":72,"column":22},"end":{"row":72,"column":23},"action":"insert","lines":["_"],"id":1785},{"start":{"row":72,"column":23},"end":{"row":72,"column":24},"action":"insert","lines":["n"]},{"start":{"row":72,"column":24},"end":{"row":72,"column":25},"action":"insert","lines":["a"]},{"start":{"row":72,"column":25},"end":{"row":72,"column":26},"action":"insert","lines":["m"]},{"start":{"row":72,"column":26},"end":{"row":72,"column":27},"action":"insert","lines":["e"]}],[{"start":{"row":73,"column":17},"end":{"row":73,"column":27},"action":"remove","lines":["deleted_on"],"id":1786},{"start":{"row":73,"column":17},"end":{"row":73,"column":18},"action":"insert","lines":["a"]},{"start":{"row":73,"column":18},"end":{"row":73,"column":19},"action":"insert","lines":["l"]},{"start":{"row":73,"column":19},"end":{"row":73,"column":20},"action":"insert","lines":["b"]},{"start":{"row":73,"column":20},"end":{"row":73,"column":21},"action":"insert","lines":["u"]},{"start":{"row":73,"column":21},"end":{"row":73,"column":22},"action":"insert","lines":["m"]}],[{"start":{"row":73,"column":17},"end":{"row":73,"column":22},"action":"remove","lines":["album"],"id":1787},{"start":{"row":73,"column":17},"end":{"row":73,"column":34},"action":"insert","lines":["album_description"]}],[{"start":{"row":73,"column":49},"end":{"row":73,"column":57},"action":"remove","lines":["        "],"id":1788},{"start":{"row":73,"column":49},"end":{"row":74,"column":0},"action":"insert","lines":["",""]},{"start":{"row":74,"column":0},"end":{"row":74,"column":16},"action":"insert","lines":["                "]}],[{"start":{"row":74,"column":16},"end":{"row":74,"column":18},"action":"insert","lines":["''"],"id":1789}],[{"start":{"row":74,"column":17},"end":{"row":74,"column":18},"action":"insert","lines":["e"],"id":1790},{"start":{"row":74,"column":18},"end":{"row":74,"column":19},"action":"insert","lines":["d"]},{"start":{"row":74,"column":19},"end":{"row":74,"column":20},"action":"insert","lines":["i"]},{"start":{"row":74,"column":20},"end":{"row":74,"column":21},"action":"insert","lines":["t"]}],[{"start":{"row":74,"column":21},"end":{"row":74,"column":22},"action":"insert","lines":["e"],"id":1791},{"start":{"row":74,"column":22},"end":{"row":74,"column":23},"action":"insert","lines":["d"]}],[{"start":{"row":74,"column":17},"end":{"row":74,"column":23},"action":"remove","lines":["edited"],"id":1792},{"start":{"row":74,"column":17},"end":{"row":74,"column":26},"action":"insert","lines":["edited_on"]}],[{"start":{"row":74,"column":27},"end":{"row":74,"column":28},"action":"insert","lines":[":"],"id":1793}],[{"start":{"row":74,"column":28},"end":{"row":74,"column":29},"action":"insert","lines":[" "],"id":1794},{"start":{"row":74,"column":29},"end":{"row":74,"column":30},"action":"insert","lines":[","]}],[{"start":{"row":74,"column":29},"end":{"row":74,"column":41},"action":"insert","lines":["timestamp(),"],"id":1795}],[{"start":{"row":74,"column":40},"end":{"row":74,"column":41},"action":"remove","lines":[","],"id":1796}],[{"start":{"row":72,"column":29},"end":{"row":72,"column":32},"action":"remove","lines":["'1'"],"id":1797}],[{"start":{"row":72,"column":29},"end":{"row":72,"column":30},"action":"insert","lines":[" "],"id":1798},{"start":{"row":72,"column":30},"end":{"row":72,"column":31},"action":"insert","lines":["a"]},{"start":{"row":72,"column":31},"end":{"row":72,"column":32},"action":"insert","lines":["l"]},{"start":{"row":72,"column":32},"end":{"row":72,"column":33},"action":"insert","lines":["b"]},{"start":{"row":72,"column":33},"end":{"row":72,"column":34},"action":"insert","lines":["u"]},{"start":{"row":72,"column":34},"end":{"row":72,"column":35},"action":"insert","lines":["m"]}],[{"start":{"row":72,"column":35},"end":{"row":72,"column":36},"action":"insert","lines":["_"],"id":1799},{"start":{"row":72,"column":36},"end":{"row":72,"column":37},"action":"insert","lines":["n"]},{"start":{"row":72,"column":37},"end":{"row":72,"column":38},"action":"insert","lines":["a"]},{"start":{"row":72,"column":38},"end":{"row":72,"column":39},"action":"insert","lines":["m"]},{"start":{"row":72,"column":39},"end":{"row":72,"column":40},"action":"insert","lines":["e"]}],[{"start":{"row":72,"column":40},"end":{"row":72,"column":44},"action":"insert","lines":["    "],"id":1800}],[{"start":{"row":72,"column":44},"end":{"row":72,"column":48},"action":"insert","lines":["    "],"id":1801}],[{"start":{"row":72,"column":44},"end":{"row":72,"column":48},"action":"remove","lines":["    "],"id":1802},{"start":{"row":72,"column":40},"end":{"row":72,"column":44},"action":"remove","lines":["    "]},{"start":{"row":72,"column":39},"end":{"row":72,"column":40},"action":"remove","lines":["e"]}],[{"start":{"row":72,"column":39},"end":{"row":72,"column":40},"action":"insert","lines":["e"],"id":1803}],[{"start":{"row":73,"column":37},"end":{"row":73,"column":48},"action":"remove","lines":["timestamp()"],"id":1804},{"start":{"row":73,"column":37},"end":{"row":73,"column":38},"action":"insert","lines":["a"]},{"start":{"row":73,"column":38},"end":{"row":73,"column":39},"action":"insert","lines":["l"]},{"start":{"row":73,"column":39},"end":{"row":73,"column":40},"action":"insert","lines":["b"]},{"start":{"row":73,"column":40},"end":{"row":73,"column":41},"action":"insert","lines":["u"]},{"start":{"row":73,"column":41},"end":{"row":73,"column":42},"action":"insert","lines":["m"]}],[{"start":{"row":73,"column":37},"end":{"row":73,"column":42},"action":"remove","lines":["album"],"id":1805},{"start":{"row":73,"column":37},"end":{"row":73,"column":54},"action":"insert","lines":["album_description"]}],[{"start":{"row":78,"column":35},"end":{"row":78,"column":39},"action":"remove","lines":["edit"],"id":1806},{"start":{"row":78,"column":35},"end":{"row":78,"column":36},"action":"insert","lines":["d"]},{"start":{"row":78,"column":36},"end":{"row":78,"column":37},"action":"insert","lines":["i"]},{"start":{"row":78,"column":37},"end":{"row":78,"column":38},"action":"insert","lines":["s"]},{"start":{"row":78,"column":38},"end":{"row":78,"column":39},"action":"insert","lines":["p"]},{"start":{"row":78,"column":39},"end":{"row":78,"column":40},"action":"insert","lines":["l"]},{"start":{"row":78,"column":40},"end":{"row":78,"column":41},"action":"insert","lines":["a"]},{"start":{"row":78,"column":41},"end":{"row":78,"column":42},"action":"insert","lines":["y"]}],[{"start":{"row":83,"column":0},"end":{"row":104,"column":27},"action":"remove","lines":["@app.route('/task/<taskid>/update', methods=['POST'])","def process_update_task(taskid):","    title = request.form.get('title')","    description = request.form.get('description')","    completed = request.form.get('completed')","        ","    task = conn[DATABASE_NAME][TASKS].find_one({","        '_id':ObjectId(taskid)","    })","    ","    # Use mongo to update","    conn[DATABASE_NAME][TASKS].update({","        '_id':ObjectId(taskid)","    }, {","        '$set': {","            'title' : title,","            'description': description,","            'completed': completed","        }","    })","    ","    # Set the flash message"],"id":1807},{"start":{"row":82,"column":0},"end":{"row":83,"column":0},"action":"remove","lines":["",""]},{"start":{"row":81,"column":0},"end":{"row":82,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":77,"column":4},"end":{"row":77,"column":25},"action":"insert","lines":["flash(\"Task updated\")"],"id":1808}],[{"start":{"row":77,"column":11},"end":{"row":77,"column":23},"action":"remove","lines":["Task updated"],"id":1809},{"start":{"row":77,"column":11},"end":{"row":77,"column":12},"action":"insert","lines":["S"]},{"start":{"row":77,"column":12},"end":{"row":77,"column":13},"action":"insert","lines":["u"]},{"start":{"row":77,"column":13},"end":{"row":77,"column":14},"action":"insert","lines":["c"]},{"start":{"row":77,"column":14},"end":{"row":77,"column":15},"action":"insert","lines":["c"]},{"start":{"row":77,"column":15},"end":{"row":77,"column":16},"action":"insert","lines":["e"]},{"start":{"row":77,"column":16},"end":{"row":77,"column":17},"action":"insert","lines":["s"]},{"start":{"row":77,"column":17},"end":{"row":77,"column":18},"action":"insert","lines":["s"]},{"start":{"row":77,"column":18},"end":{"row":77,"column":19},"action":"insert","lines":["f"]}],[{"start":{"row":77,"column":19},"end":{"row":77,"column":20},"action":"insert","lines":["u"],"id":1810},{"start":{"row":77,"column":20},"end":{"row":77,"column":21},"action":"insert","lines":["l"]},{"start":{"row":77,"column":21},"end":{"row":77,"column":22},"action":"insert","lines":["l"]},{"start":{"row":77,"column":22},"end":{"row":77,"column":23},"action":"insert","lines":["y"]}],[{"start":{"row":77,"column":23},"end":{"row":77,"column":24},"action":"insert","lines":[" "],"id":1811},{"start":{"row":77,"column":24},"end":{"row":77,"column":25},"action":"insert","lines":["e"]},{"start":{"row":77,"column":25},"end":{"row":77,"column":26},"action":"insert","lines":["d"]},{"start":{"row":77,"column":26},"end":{"row":77,"column":27},"action":"insert","lines":["i"]},{"start":{"row":77,"column":27},"end":{"row":77,"column":28},"action":"insert","lines":["t"]},{"start":{"row":77,"column":28},"end":{"row":77,"column":29},"action":"insert","lines":["e"]},{"start":{"row":77,"column":29},"end":{"row":77,"column":30},"action":"insert","lines":["d"]},{"start":{"row":77,"column":30},"end":{"row":77,"column":31},"action":"insert","lines":["."]}],[{"start":{"row":81,"column":0},"end":{"row":83,"column":4},"action":"remove","lines":["","    flash(\"Task updated\")","    "],"id":1812}],[{"start":{"row":77,"column":0},"end":{"row":78,"column":0},"action":"insert","lines":["",""],"id":1813}],[{"start":{"row":84,"column":4},"end":{"row":84,"column":37},"action":"remove","lines":["return redirect(url_for('index'))"],"id":1814},{"start":{"row":84,"column":4},"end":{"row":84,"column":46},"action":"insert","lines":["return redirect(url_for('display_albums'))"]}],[{"start":{"row":80,"column":0},"end":{"row":83,"column":38},"action":"remove","lines":["    ","    ","","    # redirect back to the index route"],"id":1815},{"start":{"row":79,"column":72},"end":{"row":80,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":90,"column":0},"end":{"row":91,"column":0},"action":"remove","lines":["",""],"id":1816},{"start":{"row":89,"column":0},"end":{"row":90,"column":0},"action":"remove","lines":["",""]},{"start":{"row":88,"column":0},"end":{"row":89,"column":0},"action":"remove","lines":["",""]},{"start":{"row":87,"column":0},"end":{"row":88,"column":0},"action":"remove","lines":["",""]},{"start":{"row":86,"column":0},"end":{"row":87,"column":0},"action":"remove","lines":["",""]},{"start":{"row":85,"column":0},"end":{"row":86,"column":0},"action":"remove","lines":["",""]},{"start":{"row":84,"column":0},"end":{"row":85,"column":0},"action":"remove","lines":["",""]},{"start":{"row":83,"column":4},"end":{"row":84,"column":0},"action":"remove","lines":["",""]},{"start":{"row":83,"column":0},"end":{"row":83,"column":4},"action":"remove","lines":["    "]},{"start":{"row":82,"column":4},"end":{"row":83,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":82,"column":0},"end":{"row":82,"column":4},"action":"remove","lines":["    "],"id":1817}],[{"start":{"row":82,"column":0},"end":{"row":83,"column":0},"action":"remove","lines":["",""],"id":1818},{"start":{"row":81,"column":4},"end":{"row":82,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":81,"column":4},"end":{"row":82,"column":0},"action":"remove","lines":["",""],"id":1819}],[{"start":{"row":79,"column":28},"end":{"row":79,"column":47},"action":"remove","lines":["layout1display.html"],"id":1820},{"start":{"row":79,"column":28},"end":{"row":79,"column":47},"action":"insert","lines":["layout1display.html"]}],[{"start":{"row":80,"column":29},"end":{"row":80,"column":43},"action":"remove","lines":["display_albums"],"id":1821},{"start":{"row":80,"column":29},"end":{"row":80,"column":51},"action":"insert","lines":["display_selected_album"]}],[{"start":{"row":79,"column":0},"end":{"row":79,"column":72},"action":"remove","lines":["    return render_template(\"layout1display.html\", data = selected_album)"],"id":1822},{"start":{"row":78,"column":33},"end":{"row":79,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":81,"column":0},"end":{"row":82,"column":0},"action":"remove","lines":["",""],"id":1823},{"start":{"row":80,"column":4},"end":{"row":81,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":79,"column":52},"end":{"row":79,"column":53},"action":"insert","lines":[","],"id":1824}],[{"start":{"row":79,"column":53},"end":{"row":79,"column":54},"action":"insert","lines":[" "],"id":1825}],[{"start":{"row":79,"column":54},"end":{"row":79,"column":75},"action":"insert","lines":["data = selected_album"],"id":1826}],[{"start":{"row":79,"column":52},"end":{"row":79,"column":75},"action":"remove","lines":[", data = selected_album"],"id":1827}],[{"start":{"row":61,"column":34},"end":{"row":61,"column":35},"action":"insert","lines":["_"],"id":1828},{"start":{"row":61,"column":35},"end":{"row":61,"column":36},"action":"insert","lines":["a"]},{"start":{"row":61,"column":36},"end":{"row":61,"column":37},"action":"insert","lines":["l"]},{"start":{"row":61,"column":37},"end":{"row":61,"column":38},"action":"insert","lines":["b"]},{"start":{"row":61,"column":38},"end":{"row":61,"column":39},"action":"insert","lines":["u"]},{"start":{"row":61,"column":39},"end":{"row":61,"column":40},"action":"insert","lines":["m"]}],[{"start":{"row":79,"column":4},"end":{"row":79,"column":54},"action":"remove","lines":["return redirect(url_for('display_selected_album'))"],"id":1829},{"start":{"row":79,"column":4},"end":{"row":79,"column":71},"action":"insert","lines":["return render_template(\"layout1delete.html\", data = selected_album)"]}],[{"start":{"row":79,"column":35},"end":{"row":79,"column":41},"action":"remove","lines":["delete"],"id":1830},{"start":{"row":79,"column":35},"end":{"row":79,"column":36},"action":"insert","lines":["e"]},{"start":{"row":79,"column":36},"end":{"row":79,"column":37},"action":"insert","lines":["d"]},{"start":{"row":79,"column":37},"end":{"row":79,"column":38},"action":"insert","lines":["i"]},{"start":{"row":79,"column":38},"end":{"row":79,"column":39},"action":"insert","lines":["t"]}],[{"start":{"row":60,"column":14},"end":{"row":60,"column":18},"action":"remove","lines":["edit"],"id":1831},{"start":{"row":60,"column":14},"end":{"row":60,"column":15},"action":"insert","lines":["s"]},{"start":{"row":60,"column":15},"end":{"row":60,"column":16},"action":"insert","lines":["h"]},{"start":{"row":60,"column":16},"end":{"row":60,"column":17},"action":"insert","lines":["o"]},{"start":{"row":60,"column":17},"end":{"row":60,"column":18},"action":"insert","lines":["w"]}],[{"start":{"row":60,"column":18},"end":{"row":60,"column":19},"action":"insert","lines":[" "],"id":1832}],[{"start":{"row":60,"column":19},"end":{"row":60,"column":28},"action":"remove","lines":[" selected"],"id":1833}],[{"start":{"row":60,"column":19},"end":{"row":60,"column":20},"action":"remove","lines":[" "],"id":1834},{"start":{"row":60,"column":18},"end":{"row":60,"column":19},"action":"remove","lines":[" "]},{"start":{"row":60,"column":17},"end":{"row":60,"column":18},"action":"remove","lines":["w"]},{"start":{"row":60,"column":16},"end":{"row":60,"column":17},"action":"remove","lines":["o"]},{"start":{"row":60,"column":15},"end":{"row":60,"column":16},"action":"remove","lines":["h"]},{"start":{"row":60,"column":14},"end":{"row":60,"column":15},"action":"remove","lines":["s"]}],[{"start":{"row":60,"column":14},"end":{"row":60,"column":15},"action":"insert","lines":["f"],"id":1835},{"start":{"row":60,"column":15},"end":{"row":60,"column":16},"action":"insert","lines":["o"]},{"start":{"row":60,"column":16},"end":{"row":60,"column":17},"action":"insert","lines":["r"]},{"start":{"row":60,"column":17},"end":{"row":60,"column":18},"action":"insert","lines":["m"]}],[{"start":{"row":60,"column":18},"end":{"row":60,"column":19},"action":"insert","lines":[" "],"id":1836},{"start":{"row":60,"column":19},"end":{"row":60,"column":20},"action":"insert","lines":["t"]},{"start":{"row":60,"column":20},"end":{"row":60,"column":21},"action":"insert","lines":["o"]}],[{"start":{"row":60,"column":21},"end":{"row":60,"column":22},"action":"insert","lines":[" "],"id":1837},{"start":{"row":60,"column":22},"end":{"row":60,"column":23},"action":"insert","lines":["e"]},{"start":{"row":60,"column":23},"end":{"row":60,"column":24},"action":"insert","lines":["d"]},{"start":{"row":60,"column":24},"end":{"row":60,"column":25},"action":"insert","lines":["i"]},{"start":{"row":60,"column":25},"end":{"row":60,"column":26},"action":"insert","lines":["t"]}],[{"start":{"row":60,"column":26},"end":{"row":60,"column":27},"action":"insert","lines":[" "],"id":1838}],[{"start":{"row":61,"column":41},"end":{"row":61,"column":42},"action":"insert","lines":[","],"id":1839},{"start":{"row":61,"column":42},"end":{"row":61,"column":43},"action":"insert","lines":[" "]},{"start":{"row":61,"column":43},"end":{"row":61,"column":44},"action":"insert","lines":["m"]},{"start":{"row":61,"column":44},"end":{"row":61,"column":45},"action":"insert","lines":["e"]},{"start":{"row":61,"column":45},"end":{"row":61,"column":46},"action":"insert","lines":["t"]},{"start":{"row":61,"column":46},"end":{"row":61,"column":47},"action":"insert","lines":["h"]},{"start":{"row":61,"column":47},"end":{"row":61,"column":48},"action":"insert","lines":["o"]},{"start":{"row":61,"column":48},"end":{"row":61,"column":49},"action":"insert","lines":["d"]},{"start":{"row":61,"column":49},"end":{"row":61,"column":50},"action":"insert","lines":["s"]},{"start":{"row":61,"column":50},"end":{"row":61,"column":51},"action":"insert","lines":["="]}],[{"start":{"row":61,"column":51},"end":{"row":61,"column":53},"action":"insert","lines":["{}"],"id":1840}],[{"start":{"row":61,"column":52},"end":{"row":61,"column":54},"action":"insert","lines":["''"],"id":1841}],[{"start":{"row":61,"column":54},"end":{"row":61,"column":55},"action":"remove","lines":["}"],"id":1842},{"start":{"row":61,"column":53},"end":{"row":61,"column":54},"action":"remove","lines":["'"]},{"start":{"row":61,"column":52},"end":{"row":61,"column":53},"action":"remove","lines":["'"]},{"start":{"row":61,"column":51},"end":{"row":61,"column":52},"action":"remove","lines":["{"]}],[{"start":{"row":61,"column":51},"end":{"row":61,"column":53},"action":"insert","lines":["[]"],"id":1843}],[{"start":{"row":61,"column":52},"end":{"row":61,"column":54},"action":"insert","lines":["''"],"id":1844}],[{"start":{"row":61,"column":53},"end":{"row":61,"column":54},"action":"insert","lines":["P"],"id":1845},{"start":{"row":61,"column":54},"end":{"row":61,"column":55},"action":"insert","lines":["O"]},{"start":{"row":61,"column":55},"end":{"row":61,"column":56},"action":"insert","lines":["S"]},{"start":{"row":61,"column":56},"end":{"row":61,"column":57},"action":"insert","lines":["T"]}],[{"start":{"row":61,"column":41},"end":{"row":61,"column":59},"action":"remove","lines":[", methods=['POST']"],"id":1846}],[{"start":{"row":63,"column":4},"end":{"row":63,"column":6},"action":"insert","lines":["# "],"id":1847}],[{"start":{"row":64,"column":4},"end":{"row":64,"column":6},"action":"insert","lines":["# "],"id":1848}],[{"start":{"row":63,"column":4},"end":{"row":63,"column":6},"action":"remove","lines":["# "],"id":1849}],[{"start":{"row":64,"column":4},"end":{"row":64,"column":6},"action":"remove","lines":["# "],"id":1850}],[{"start":{"row":63,"column":4},"end":{"row":63,"column":6},"action":"insert","lines":["# "],"id":1851}],[{"start":{"row":64,"column":4},"end":{"row":64,"column":6},"action":"insert","lines":["# "],"id":1852}],[{"start":{"row":63,"column":4},"end":{"row":63,"column":6},"action":"remove","lines":["# "],"id":1853}],[{"start":{"row":63,"column":4},"end":{"row":63,"column":6},"action":"insert","lines":["# "],"id":1854}],[{"start":{"row":68,"column":4},"end":{"row":68,"column":6},"action":"insert","lines":["# "],"id":1855},{"start":{"row":69,"column":4},"end":{"row":69,"column":6},"action":"insert","lines":["# "]},{"start":{"row":70,"column":4},"end":{"row":70,"column":6},"action":"insert","lines":["# "]},{"start":{"row":71,"column":4},"end":{"row":71,"column":6},"action":"insert","lines":["# "]},{"start":{"row":72,"column":4},"end":{"row":72,"column":6},"action":"insert","lines":["# "]},{"start":{"row":73,"column":4},"end":{"row":73,"column":6},"action":"insert","lines":["# "]},{"start":{"row":74,"column":4},"end":{"row":74,"column":6},"action":"insert","lines":["# "]},{"start":{"row":75,"column":4},"end":{"row":75,"column":6},"action":"insert","lines":["# "]},{"start":{"row":76,"column":4},"end":{"row":76,"column":6},"action":"insert","lines":["# "]},{"start":{"row":78,"column":4},"end":{"row":78,"column":6},"action":"insert","lines":["# "]}],[{"start":{"row":60,"column":34},"end":{"row":60,"column":43},"action":"remove","lines":["Currently"],"id":1856},{"start":{"row":60,"column":34},"end":{"row":60,"column":35},"action":"insert","lines":["W"]},{"start":{"row":60,"column":35},"end":{"row":60,"column":36},"action":"insert","lines":["o"]},{"start":{"row":60,"column":36},"end":{"row":60,"column":37},"action":"insert","lines":["r"]},{"start":{"row":60,"column":37},"end":{"row":60,"column":38},"action":"insert","lines":["k"]},{"start":{"row":60,"column":38},"end":{"row":60,"column":39},"action":"insert","lines":["i"]},{"start":{"row":60,"column":39},"end":{"row":60,"column":40},"action":"insert","lines":["n"]},{"start":{"row":60,"column":40},"end":{"row":60,"column":41},"action":"insert","lines":["g"]}]]},"ace":{"folds":[],"scrolltop":550,"scrollleft":0,"selection":{"start":{"row":65,"column":4},"end":{"row":65,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":44,"state":"start","mode":"ace/mode/python"}},"timestamp":1566972694648}